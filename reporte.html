<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Reporte de Ventas — OnceyDoce</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Libs -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<style>
    :root{
      --surface:#ffffff; --surface-weak:#f6f7f9;
      --accent-50:#fff1f2; --accent-100:#ffe4e6;
      --accent-500:#f43f5e; --accent-600:#fb8c00;
    }
    html,body{height:100%}
    .container-grid{display:grid;grid-template-columns:repeat(12,minmax(0,1fr));gap:1rem}
    @media (min-width:1024px){ .container-grid{gap:1rem} }

    .card{ background:var(--surface); border-radius:1rem; border:1px solid rgba(15,23,42,.08); }
    .btn{ padding:.5rem .875rem; border-radius:.75rem; border:1px solid rgba(15,23,42,.10); background:#fff; }
    .btn:hover{ background:#f9fafb }
    .btn-primary{ border:none; background:var(--accent-600); color:#fff }
    .btn-primary:hover{ background:var(--accent-500) }
    .btn-ghost{ border-color:rgba(15,23,42,.10); background:#fff }
    .btn-ghost:hover{ background:#f9fafb }
    .inp{ border-radius:.75rem; border:1px solid #e5e7eb; padding:.5rem .75rem }
    .inp:focus{ outline:none; box-shadow:0 0 0 3px rgba(244,63,94,.15),0 0 0 1px var(--accent-500); border-color:var(--accent-500) }
    .navlink{ display:flex; gap:.625rem; align-items:center; padding:.5rem .75rem; border-radius:.75rem; color:#334155 }
    .navlink:hover{ background:#f3f4f6 }
    .navlink.active{ background:var(--accent-50); color:var(--accent-600) }
    .badge{ display:inline-flex; align-items:center; gap:.375rem; padding:.25rem .5rem; border-radius:999px; font-size:.75rem; color:#475569; background:#f3f4f6; }
  </style>
  <style>
  /* Tipografías en negro en todo el sitio */
  body { color:#000; }
  .text-slate-800,.text-slate-700,.text-slate-600,.text-slate-500,.text-slate-400,
  .text-gray-800,.text-gray-700,.text-gray-600,.text-gray-500,.text-gray-400 {
    color:#000 !important;
  }
  /* Badges y textos “muted” también en negro */
  .badge { color:#000; }
</style>

  <script>
    const STORE_NAME = "El Forastero";
    const ORDERS_WEBAPP_URL = '/.netlify/functions/gs-order';
    const API = '/.netlify/functions/gs-order';
  </script>
</head>
<body class="bg-slate-50  text-black dark:text-black">


  <main class="md:ml-64 p-4 sm:p-6">
    <div class="max-w-8xl mx-auto space-y-6">
      <div class="grid grid-cols-12 gap-4 lg:gap-6">
        <!-- Sidebar -->
        <aside class="hidden md:block md:col-span-3 lg:col-span-2">
          <div class="sticky top-4 space-y-4">
            <!-- Logo / título -->
            <div class="flex items-center gap-3">
              <div class="h-10 w-10 rounded-xl bg-gradient-to-tr from-amber-500 to-orange-400 flex items-center justify-center shadow-sm">
                <!-- Icono gráfico simple -->
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M4 7h16M4 12h16M4 17h10"/>
                </svg>
              </div>
              <div>
                <h1 class="text-lg font-bold leading-tight">POS El Forastero</h1>
                <p class="text-xs text-gray-500">Reporte analítico de ventas</p>
              </div>
            </div>

            <!-- Navegación simple -->
<nav class="mt-2 px-2 space-y-1">
     <a href="./index.html" class="navlink" title="POS">
    <!-- Cash/Ticket -->
    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
      <!-- base -->
      <path d="M4 10h16a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-6a2 2 0 0 1 2-2Z"/>
      <!-- gaveta -->
      <path d="M7 16h10"/>
      <path d="M9.5 13h5"/>
      <!-- ticketcito arriba -->
      <path d="M9 4h6v4l-1-.6-1 .6-1-.6-1 .6-1-.6-1 .6V4Z"/>
    </svg>
    <span>POS</span>
  </a>

  <!-- Reporte -->
  <a href="./reporte.html" class="navlink" title="Reporte">
    <!-- Chart bars -->
    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
      <path d="M5 12v7M10 9v10M15 5v14M20 8v11"/>
    </svg>
    <span>Reporte</span>
  </a>
</nav>

            <!-- Estado -->
            <div class="mt-6">
              <div class="badge">
                <span class="inline-block w-2 h-2 rounded-full bg-emerald-500"></span>
                <span id="statusText">En línea</span>
              </div>
            </div>

            <!-- Tips / ayuda -->
            <div class="mt-4 text-xs text-gray-500 space-y-1">
              <p>1. En el campo URL CSV pegá la hoja <strong>VENTAS</strong> publicada del mismo spreadsheet que usa el POS.</p>
              <p>2. Usá los filtros de fecha / categoría / método para explorar las ventas.</p>
            </div>
          </div>
        </aside>

        <!-- Contenido principal -->
        <section class="col-span-12 md:col-span-9 lg:col-span-10 space-y-4 lg:space-y-6">
          <!-- Header -->
          <header class="card p-4 sm:p-5 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
            <div>
              <h2 class="text-xl sm:text-2xl font-bold tracking-tight">Reporte de Ventas</h2>
              <p class="text-xs sm:text-sm text-gray-500">
                Análisis diario, semanal y mensual de tus ventas registradas desde el POS.
              </p>
            </div>
            <div class="flex flex-wrap gap-2 items-center">
              <button id="btnHoy" class="text-xs sm:text-sm px-3 py-1.5 rounded-xl bg-gray-100 hover:bg-gray-200">Hoy</button>
              <button id="btnSemana" class="text-xs sm:text-sm px-3 py-1.5 rounded-xl bg-gray-100 hover:bg-gray-200">Semana</button>
              <button id="btnMes" class="text-xs sm:text-sm px-3 py-1.5 rounded-xl bg-gray-100 hover:bg-gray-200">Mes</button>
            </div>
          </header>

          <!-- Filtros superiores -->
          <div class="card p-4 sm:p-5">
            <div class="grid grid-cols-12 gap-4">
              <div class="col-span-12 md:col-span-4 space-y-2">
                <label class="block text-xs font-medium text-gray-500">Rango de fechas</label>
                <div class="flex gap-2">
                  <input id="fDesde" type="date" class="inp w-1/2" />
                  <input id="fHasta" type="date" class="inp w-1/2" />
                </div>
              </div>
              <div class="col-span-12 md:col-span-3 space-y-2">
                <label class="block text-xs font-medium text-gray-500">Método de pago</label>
                <select id="selMetodo" class="inp w-full">
                  <option value="">Todos</option>
                  <option value="efectivo">Efectivo</option>
                  <option value="mp">Mercado Pago</option>
                  <option value="debito">Débito</option>
                  <option value="credito">Crédito</option>
                </select>
              </div>
              <div class="col-span-12 md:col-span-3 space-y-2">
                <label class="block text-xs font-medium text-gray-500">Buscar cliente / mesa / item</label>
                <input id="txtBuscar" type="text" class="inp w-full" placeholder="Ej: Lucas, Mesa 3, IPA..." />
              </div>
              <div class="col-span-12 md:col-span-2 flex items-end">
                <button id="btnResetFiltros" class="w-full text-xs sm:text-sm px-3 py-2 rounded-xl bg-gray-100 hover:bg-gray-200">
                  Limpiar filtros
                </button>
              </div>
            </div>
          </div>

          <!-- Bloque métricas + chart principales -->
          <div class="grid grid-cols-12 gap-4 lg:gap-6">
            <!-- Métricas -->
            <div class="col-span-12 lg:col-span-4 space-y-4">
              <div class="card p-4 space-y-3">
                <div class="flex items-center justify-between gap-2">
                  <h3 class="text-sm font-semibold">Resumen del período</h3>
                  <span id="selResumen" class="text-xs px-2 py-1 rounded-full bg-gray-100">Personalizado</span>
                </div>
                <dl class="space-y-3">
                  <div class="flex items-baseline justify-between">
                    <dt class="text-xs text-gray-500">Ventas totales</dt>
                    <dd id="mVentas" class="text-lg font-bold">—</dd>
                  </div>
                  <div class="flex items-baseline justify-between">
                    <dt class="text-xs text-gray-500">Ganancia estimada</dt>
                    <dd id="mGanancia" class="text-lg font-bold">—</dd>
                  </div>
                  <div class="flex items-baseline justify-between">
                    <dt class="text-xs text-gray-500">Tickets</dt>
                    <dd id="mTickets" class="text-lg font-bold">—</dd>
                  </div>
                  <div class="flex items-baseline justify-between">
                    <dt class="text-xs text-gray-500">Ticket promedio</dt>
                    <dd id="mTicketProm" class="text-lg font-bold">—</dd>
                  </div>
                </dl>
              </div>

              <!-- Top categorías -->
              <div class="card p-4">
                <div class="flex items-center justify-between mb-2">
                  <h3 class="text-sm font-semibold">Top categorías</h3>
                  <button id="btnVerCategorias" class="text-xs text-gray-500 hover:underline">Ver detalle</button>
                </div>
                <div id="listaTopCategorias" class="space-y-2 text-xs">
                  <!-- se completa por JS -->
                </div>
              </div>

              <!-- Top items -->
              <div class="card p-4">
                <div class="flex items-center justify-between mb-2">
                  <h3 class="text-sm font-semibold">Top productos</h3>
                  <button id="btnVerItems" class="text-xs text-gray-500 hover:underline">Ver detalle</button>
                </div>
                <div id="listaTopItems" class="space-y-2 text-xs">
                  <!-- se completa por JS -->
                </div>
              </div>
            </div>

            <!-- Charts -->
            <div class="col-span-12 lg:col-span-8 space-y-4">
              <div class="card p-4">
                <div class="flex items-center justify-between mb-2">
                  <h3 class="text-sm font-semibold">Ventas por día</h3>
                  <p class="text-xs text-gray-500">Monto total diario (histograma)</p>
                </div>
                <div class="h-60">
                  <canvas id="chartVentasDia"></canvas>
                </div>
              </div>

              <div class="grid grid-cols-12 gap-4">
                <div class="col-span-12 md:col-span-6">
                  <div class="card p-4">
                    <div class="flex items-center justify-between mb-2">
                      <h3 class="text-sm font-semibold">Métodos de pago</h3>
                      <p class="text-xs text-gray-500">Participación por monto</p>
                    </div>
                    <div class="h-52">
                      <canvas id="chartMetodos"></canvas>
                    </div>
                  </div>
                </div>
                <div class="col-span-12 md:col-span-6">
                  <div class="card p-4">
                    <div class="flex items-center justify-between mb-2">
                      <h3 class="text-sm font-semibold">Categorías</h3>
                      <p class="text-xs text-gray-500">Top categorías por ventas</p>
                    </div>
                    <div class="h-52">
                      <canvas id="chartCategorias"></canvas>
                    </div>
                  </div>
                </div>
              </div>

            </div>
          </div>

          <!-- Tabla de ventas -->
          <div class="card p-4 sm:p-5 space-y-4">
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
              <div>
                <h3 class="text-sm font-semibold">Detalle de ventas</h3>
                <p class="text-xs text-gray-500">Todas las ventas filtradas en el período.</p>
              </div>
              <div class="flex flex-wrap gap-2 items-center">
                <button id="btnExcel" class="text-sm px-3 py-1.5 rounded-xl bg-gray-100 hover:bg-gray-200">Descargar Excel</button>
                <button id="btnExcelFact" class="text-sm px-3 py-1.5 rounded-xl bg-gray-100 hover:bg-gray-200">Exportar Facturación</button>
                <button id="btnExpandir" class="text-sm px-3 py-1.5 rounded-xl bg-gray-100 hover:bg-gray-200">Expandir items</button>
              </div>
            </div>
            <div class="overflow-x-auto">
              <table class="w-full text-sm">
                <thead class="bg-gray-50 text-slate-600">
                  <tr>
                    <th class="text-left p-2">Fecha</th>
                    <th class="text-left p-2">Cliente</th>
                    <th class="text-left p-2">Mesa</th>
                    <th class="text-left p-2">Método</th>
                    <th class="text-left p-2">Items</th>
                    <th class="text-right p-2">Total</th>
                    <th class="text-right p-2">Ganancia</th>
                  </tr>
                </thead>
                <tbody id="tblVentasBody" class="divide-y divide-gray-100">
                  <!-- filas dinámicas -->
                </tbody>
              </table>
            </div>

            <!-- Paginación -->
            <div class="flex items-center justify-between mt-3 text-xs text-gray-500">
              <div>
                <span id="lblPagina">Página 1</span>
                <span id="lblRango" class="ml-2 text-gray-400">Mostrando 0–0 de 0</span>
              </div>
              <div class="flex gap-1">
                <button id="btnPrev" class="px-2 py-1 rounded-lg bg-gray-100 hover:bg-gray-200 disabled:opacity-40">Anterior</button>
                <button id="btnNext" class="px-2 py-1 rounded-lg bg-gray-100 hover:bg-gray-200 disabled:opacity-40">Siguiente</button>
              </div>
            </div>
          </div>

          <!-- Diagnóstico / consola -->
          <div class="card p-4 space-y-2 text-xs text-gray-600">
            <div class="flex items-center justify-between">
              <h3 class="text-xs font-semibold">Diagnóstico</h3>
              <button id="btnDiagToggle" class="px-2 py-1 rounded-lg bg-gray-100 hover:bg-gray-200">Ver / ocultar</button>
            </div>
            <pre id="diag" class="max-h-40 overflow-y-auto bg-gray-50 rounded-lg p-2 text-[11px]"></pre>
          </div>

          <!-- Configuración CSV -->
          <div class="card p-4 space-y-3">
            <h3 class="text-sm font-semibold">Origen de datos</h3>
            <p class="text-xs text-gray-500">
              Pegá acá la URL de la hoja <strong>VENTAS</strong> publicada como CSV desde Google Sheets.
            </p>
            <div class="grid grid-cols-12 gap-2 items-end">
              <div class="col-span-12 md:col-span-9">
                <div class="rounded-2xl bg-white shadow p-4">
        <label class="block text-sm font-medium mb-1">URL CSV publicada (hoja POSOnceyDoce)</label>
 <input
  id="csvUrl"
  type="text"
  class="w-full rounded-xl border-gray-300"
  value="https://docs.google.com/spreadsheets/d/e/2PACX-1vQTQKDZJ8MOQM-D0qfgBlQqppWs3ilXNHG93CjC8Kjnp0h8Qwkomagzx0mu9bVx_lk5ZsfTBg0OtG8C/pub?output=csv"
/>
</div>
              </div>
              <div class="col-span-12 md:col-span-3 flex gap-2">
                <button id="btnReload" class="flex-1 px-3 py-2 rounded-xl bg-gray-100 hover:bg-gray-200 text-sm">Recargar</button>
              </div>
            </div>
          </div>

        </section>
      </div>
    </div>
  </main>

  <!-- Modal genérico para listas -->
  <div id="modalLista" class="fixed inset-0 z-40 hidden items-center justify-center bg-black/30">
    <div class="bg-white rounded-2xl shadow-xl max-w-lg w-full max-h-[80vh] flex flex-col">
      <div class="flex items-center justify-between px-4 py-3 border-b border-gray-100">
        <h3 id="modalListaTitulo" class="text-sm font-semibold">Detalle</h3>
        <button id="btnModalCerrar" class="text-gray-400 hover:text-gray-600">&times;</button>
      </div>
      <div id="modalListaBody" class="p-4 overflow-y-auto text-sm">
        <!-- contenido dinámico -->
      </div>
    </div>
  </div>

  <!-- Modal filtros avanzados -->
  <div id="modalFiltros" class="fixed inset-0 z-40 hidden items-center justify-center bg-black/30">
    <div class="bg-white rounded-2xl shadow-xl max-w-md w-full">
      <div class="flex items-center justify-between px-4 py-3 border-b border-gray-100">
        <h3 class="text-sm font-semibold">Filtros avanzados</h3>
        <button id="btnFiltCerrar" class="text-gray-400 hover:text-gray-600">&times;</button>
      </div>
      <div class="p-4 space-y-3 text-sm">
        <p class="text-xs text-gray-500">Acá podrías agregar filtros extra (por horario, por mozo, por nota, etc.).</p>
        <label class="flex items-center gap-2"><input type="checkbox" class="chkFilt" value="filtMañana"> Turno mañana</label>
        <label class="flex items-center gap-2"><input type="checkbox" class="chkFilt" value="filtTarde"> Turno tarde</label>
        <label class="flex items-center gap-2"><input type="checkbox" class="chkFilt" value="filtNoche"> Turno noche</label>
        <label class="flex items-center gap-2"><input type="checkbox" class="chkFilt" value="filtBuscar"> Buscar</label>
        <label class="flex items-center gap-2"><input type="checkbox" class="chkFilt" value="filtCategoria"> Categoría</label>
      </div>
      <div class="flex justify-end gap-2 mt-4">
        <button id="btnFiltCancelar" class="btn">Cancelar</button>
        <button id="btnFiltGuardar" class="btn">Guardar</button>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const current = location.pathname.split('/').pop() || 'index.html';
      document.querySelectorAll('.navlink').forEach(a => {
        const href = a.getAttribute('href') || '';
        if (href.endsWith(current)) a.classList.add('active');
      });
    });
  </script>

  <script src="report.js"></script>
</body>
</html>

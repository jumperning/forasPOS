<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Reporte de Ventas ‚Äî OnceyDoce</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Libs -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<style>
    :root{
      --surface:#ffffff; --surface-weak:#f6f7f9;
      --accent-50:#fff1f2; --accent-100:#ffe4e6;
      --accent-500:#f43f5e; --accent-600:#e11d48;
    }
    html,body{height:100%}
    .container-grid{display:grid;grid-template-columns:repeat(12,minmax(0,1fr));gap:1rem}
    @media (min-width:1024px){ .container-grid{gap:1rem} }

    .card{ background:var(--surface); border-radius:1rem; border:1px solid rgba(15,23,42,.08); }
    .btn{ padding:.5rem .875rem; border-radius:.75rem; border:1px solid rgba(15,23,42,.10); background:#fff; }
    .btn:hover{ background:#f9fafb }
    .btn-primary{ border:none; background:var(--accent-600); color:#fff }
    .btn-primary:hover{ background:var(--accent-500) }
    .btn-ghost{ border-color:rgba(15,23,42,.10); background:#fff }
    .btn-ghost:hover{ background:#f9fafb }
    .inp{ border-radius:.75rem; border:1px solid #e5e7eb; padding:.5rem .75rem }
    .inp:focus{ outline:none; box-shadow:0 0 0 3px rgba(244,63,94,.15),0 0 0 1px var(--accent-500); border-color:var(--accent-500) }
    .navlink{ display:flex; gap:.625rem; align-items:center; padding:.5rem .75rem; border-radius:.75rem; color:#334155 }
    .navlink:hover{ background:#f3f4f6 }
    .navlink.active{ background:var(--accent-50); color:var(--accent-600) }
    .badge{ display:inline-flex; align-items:center; gap:.375rem; padding:.25rem .5rem; border-radius:999px; font-size:.75rem; color:#475569; background:#f3f4f6; }
  </style>
  <style>
  /* Tipograf√≠as en negro en todo el sitio */
  body { color:#000; }
  .text-slate-800,.text-slate-700,.text-slate-600,.text-slate-500,.text-slate-400,
  .text-gray-800,.text-gray-700,.text-gray-600,.text-gray-500,.text-gray-400 {
    color:#000 !important;
  }
  /* Badges y textos ‚Äúmuted‚Äù tambi√©n en negro */
  .badge { color:#000; }
</style>
</head>
<body class="bg-slate-50  text-black dark:text-black">


  <!-- Sidebar -->
  <aside class="hidden md:flex md:flex-col fixed inset-y-0 left-0 w-64 bg-white border-r border-slate-200">
    <div class="px-5 pt-6 pb-4 flex items-center gap-3">
      <div class="h-9 w-9 grid place-items-center rounded-xl bg-[var(--accent-600)] text-white font-black">OD</div>
      <div>
        <div class="text-lg font-extrabold">OnceyDoce</div>
        <div class="text-xs text-slate-500">POS & Reportes</div>
      </div>
    </div>
    <nav class="mt-2 px-2 space-y-1">
     <a href="./index.html" class="navlink ${location.pathname.endsWith('index.html') ? 'active' : ''}" title="POS">
    <!-- Cash/Ticket -->
    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
      <!-- base -->
      <path d="M4 10h16a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-6a2 2 0 0 1 2-2Z"/>
      <!-- gaveta -->
      <path d="M7 16h10"/>
      <path d="M9.5 13h5"/>
      <!-- ticketcito arriba -->
      <path d="M9 4h6v4l-1-.6-1 .6-1-.6-1 .6-1-.6-1 .6V4Z"/>
    </svg>
    <span>POS</span>
  </a>

  <!-- Reporte -->
  <a href="./reporte.html" class="navlink ${location.pathname.endsWith('reporte.html') ? 'active' : ''}" title="Reporte">
    <!-- Chart bars -->
    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
      <path d="M3 20h18"/>
      <rect x="5" y="11" width="3" height="6" rx="1"/>
      <rect x="10.5" y="8" width="3" height="9" rx="1"/>
      <rect x="16" y="5" width="3" height="12" rx="1"/>
    </svg>
    <span>Reporte</span>
  </a>
    </nav>
    <div class="mt-auto p-3">
      <button id="btnLogout" class="btn w-full">Salir</button>
      <div class="text-[10px] text-slate-400 mt-2 text-center">¬© 2025 OnceyDoce</div>
    </div>
  </aside>

  <!-- Topbar (mobile) -->
  <header class="md:ml-64 sticky top-0 z-40 bg-white/70 backdrop-blur border-b border-slate-200/60">
    <div class="px-4 py-3 flex items-center justify-between md:justify-end">
      <div class="md:hidden flex items-center gap-3">
       <div class="h-9 w-9 grid place-items-center rounded-xl bg-[var(--accent-600)] text-white font-black">OD</div>
        <span class="font-bold">OnceyDoce</span>
      </div>
      <div class="text-sm text-slate-500">Reporte</div>
    </div>
  </header>

  <!-- Contenido -->
  <main class="md:ml-64 p-4 sm:p-6">
    <div class="max-w-7xl mx-auto space-y-6">

      <!-- Header de la p√°gina -->
      <header class="rounded-2xl bg-white shadow p-6 flex items-center justify-between">
        <div>
          <h1 class="text-2xl sm:text-3xl font-extrabold tracking-tight">Reporte de Ventas</h1>
          <p class="text-sm text-slate-500">An√°lisis y exportaciones</p>
        </div>
        <div class="flex items-center gap-3">
          <!-- üëÅÔ∏è mostrar/ocultar montos -->
          <button id="btnToggleMoneda" class="px-3 py-1.5 rounded-xl border border-slate-200 hover:bg-slate-50" title="Mostrar/ocultar montos">üëÅÔ∏è</button>
          <div id="statusBadge" class="text-xs px-3 py-1 rounded-full bg-gray-100">Sincronizando‚Ä¶</div>
        </div>
      </header>

      <!-- Config -->
      <section class="rounded-2xl bg-white shadow p-4">
        <label class="block text-sm font-medium mb-1">URL CSV publicada (hoja POSOnceyDoce)</label>
        <input id="csvUrl" type="text" class="w-full rounded-xl border-gray-300"
  value="" />
</div>
        <button id="btnReload" class="mt-3 px-3 py-1.5 rounded-xl bg-gray-100 hover:bg-gray-200 text-sm">Recargar</button>
      </section>

      <!-- GRID principal (mismo esquema que index) -->
      <div class="container-grid">
        <!-- Filtros -->
        <aside class="lg:col-span-3 col-span-12 bg-white rounded-2xl shadow p-4 space-y-4 h-fit lg:sticky lg:top-6">
          <div class="flex items-center justify-between">
            <h3 class="text-sm font-semibold">Filtros</h3>
            <button id="btnConfigFiltros" class="btn text-xs">Personalizar filtros</button>
          </div>

          <div id="filtMes">
            <label class="block text-sm font-medium mb-1">Mes</label>
            <select id="mesFiltro" class="w-full rounded-xl border-gray-300"></select>
          </div>

          <div id="filtDia">
            <label class="block text-sm font-medium mb-1">D√≠a</label>
            <input id="diaFiltro" type="date" class="w-full rounded-xl border-gray-300" />
            <div class="flex gap-2 mt-2">
              <button type="button" class="btn" id="btnHoy">Hoy</button>
              <button type="button" class="btn" id="btnAyer">Ayer</button>
              <button type="button" class="btn" id="btnMenos2">-2 d√≠as</button>
            </div>
            <p class="text-xs text-slate-500 mt-2">Afecta los KPIs diarios (Ganancia/Ingresos/Unidades/Ventas/Costo).</p>
          </div>

          <div id="filtHorario">
            <label class="block text-sm font-medium mb-1">Filtrar por horario (del d√≠a seleccionado)</label>
            <div class="grid grid-cols-2 gap-2">
              <div>
                <span class="text-xs text-slate-600">Desde</span>
                <input id="horaDesde" type="time" class="w-full rounded-xl border-gray-300" />
              </div>
              <div>
                <span class="text-xs text-slate-600">Hasta</span>
                <input id="horaHasta" type="time" class="w-full rounded-xl border-gray-300" />
              </div>
            </div>
            <p class="text-xs text-slate-500 mt-2">Se aplica a KPIs del d√≠a y, si el alcance es ‚ÄúD√≠a‚Äù, tambi√©n al an√°lisis.</p>
          </div>

          <div id="filtBuscar">
            <label class="block text-sm font-medium mb-1">Buscar</label>
            <input id="buscar" type="text" placeholder="producto, cliente‚Ä¶" class="w-full rounded-xl border-gray-300" />
          </div>

          <div id="filtCategoria">
            <label class="block text-sm font-medium mb-1">Filtrar por Categor√≠a</label>
            <select id="catFiltro" class="w-full rounded-xl border-gray-300">
              <option value="">Todas</option>
              <option value="Caf√©">Caf√©</option>
              <option value="Comida">Comida</option>
              <option value="Cerveza">Cerveza</option>
              <option value="Gaseosa">Gaseosa</option>
              <option value="Agua">Agua</option>
              <option value="Vino">Vino</option>
              <option value="Whisky">Whisky</option>
              <option value="Tragos">Tragos</option>
            </select>
            <p class="text-xs text-slate-500 mt-2">Por ejemplo: ‚ÄúVino‚Äù, ‚ÄúWhisky‚Äù o ‚ÄúTragos‚Äù.</p>
          </div>
        </aside>

        <!-- Contenido -->
        <main class="lg:col-span-9 col-span-12 space-y-4">
          <!-- KPIs -->
          <div class="grid grid-cols-2 sm:grid-cols-3 gap-4">
            <div class="bg-white rounded-2xl shadow p-4"><div class="text-xs text-slate-500">Ventas (mes)</div><div id="kpiVentas" class="text-2xl font-bold money">0</div></div>
            <div class="bg-white rounded-2xl shadow p-4"><div class="text-xs text-slate-500">Unidades (mes)</div><div id="kpiUnidades" class="text-2xl font-bold money">0</div></div>
            <div class="bg-white rounded-2xl shadow p-4"><div class="text-xs text-slate-500">Ingresos (mes)</div><div id="kpiIngresos" class="text-2xl font-bold money">$0</div></div>
          </div>

          <!-- KPIs del d√≠a -->
          <div class="grid grid-cols-2 sm:grid-cols-5 gap-4">
            <div class="bg-white rounded-2xl shadow p-4"><div class="text-xs text-slate-500">Ganancia (d√≠a)</div><div id="kpiGanDia" class="text-2xl font-bold money">$0</div><div id="kpiGanDiaLbl" class="text-xs text-slate-500 mt-1"></div></div>
            <div class="bg-white rounded-2xl shadow p-4"><div class="text-xs text-slate-500">Ingresos (d√≠a)</div><div id="kpiIngDia" class="text-2xl font-bold money">$0</div></div>
            <div class="bg-white rounded-2xl shadow p-4"><div class="text-xs text-slate-500">Unidades (d√≠a)</div><div id="kpiUniDia" class="text-2xl font-bold money">0</div></div>
            <div class="bg-white rounded-2xl shadow p-4"><div class="text-xs text-slate-500">Ventas (d√≠a)</div><div id="kpiVentasDia" class="text-2xl font-bold money">0</div></div>
            <div class="bg-white rounded-2xl shadow p-4"><div class="text-xs text-slate-500">Costo (d√≠a)</div><div id="kpiCostoDia" class="text-2xl font-bold money">$0</div></div>
          </div>

          <!-- An√°lisis por categor√≠a -->
          <div class="bg-white rounded-2xl shadow p-4 space-y-4">
            <div class="flex flex-wrap items-center gap-3">
              <h2 class="text-lg font-semibold mr-auto">An√°lisis por Categor√≠a</h2>
              <div class="flex gap-2">
                <span class="chip cursor-default">Caf√©</span>
                <span class="chip cursor-default">Comida</span>
                <span class="chip cursor-default">Cerveza</span>
                <span class="chip cursor-default">Gaseosa</span>
                <span class="chip cursor-default">Agua</span>
                <span class="chip cursor-default">Vino</span>
                <span class="chip cursor-default">Whisky</span>
                <span class="chip cursor-default">Tragos</span>
              </div>
            </div>

            <div class="flex flex-wrap gap-3 items-end">
              <div>
                <label class="block text-xs text-slate-600 mb-1">Alcance</label>
                <select id="alcanceSel" class="rounded-xl border-gray-300">
                  <option value="mes">Mes completo (seleccionado)</option>
                  <option value="dia">D√≠a (usa el selector de la izquierda)</option>
                  <option value="rango">Rango de fechas</option>
                </select>
              </div>
              <div id="rangoWrap" class="hidden flex items-end gap-2">
                <div><label class="block text-xs text-slate-600 mb-1">Desde</label><input id="desdeFecha" type="date" class="rounded-xl border-gray-300"></div>
                <div><label class="block text-xs text-slate-600 mb-1">Hasta</label><input id="hastaFecha" type="date" class="rounded-xl border-gray-300"></div>
                <button id="btnAplicarRango" class="btn">Aplicar</button>
              </div>
              <label class="inline-flex items-center gap-2 ml-auto">
                <input id="chkDiaDia" type="checkbox" class="rounded">
                <span class="text-sm">D√≠a a d√≠a (serie)</span>
              </label>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6" id="aggWrap">
              <div class="rounded-xl border p-3"><div class="text-sm text-slate-500 mb-2">Participaci√≥n por Unidades (%)</div><canvas id="chartPie"></canvas></div>
              <div class="rounded-xl border p-3"><div class="text-sm text-slate-500 mb-2">Unidades por Categor√≠a</div><canvas id="chartBarQty"></canvas></div>
              <div class="rounded-xl border p-3"><div class="text-sm text-slate-500 mb-2">Ganancia por Categor√≠a (ARS)</div><canvas id="chartBarProfit"></canvas></div>
            </div>

            <div id="dailyWrap" class="rounded-xl border p-3 hidden">
              <div class="text-sm text-slate-500 mb-2">Unidades ‚Äî D√≠a a d√≠a (apilado por categor√≠a)</div>
              <canvas id="chartDailyQty"></canvas>
            </div>

            <div class="overflow-x-auto">
              <table class="w-full text-sm mt-2">
                <thead class="bg-gray-50 text-slate-600">
                  <tr>
                    <th class="text-left p-2">Categor√≠a</th>
                    <th class="text-right p-2">Unidades</th>
                    <th class="text-right p-2">Veces</th>
                    <th class="text-right p-2">Ganancia</th>
                  </tr>
                </thead>
                <tbody id="tbodyResumenCat" class="divide-y"></tbody>
              </table>
            </div>
          </div>

          <!-- Top & Explorador -->
          <div class="bg-white rounded-2xl shadow p-4 space-y-4">
            <div class="flex flex-wrap gap-3 items-end">
              <h2 class="text-lg font-semibold mr-auto">Top & Explorador de √çtems</h2>
              <div>
                <label class="block text-xs text-slate-600 mb-1">Categor√≠a (opcional)</label>
                <select id="itemCatSel" class="rounded-xl border-gray-300">
                  <option value="">Todas</option>
                  <option>Caf√©</option><option>Comida</option><option>Cerveza</option>
                  <option>Gaseosa</option><option>Agua</option><option>Vino</option>
                  <option>Whisky</option><option>Tragos</option>
                </select>
              </div>
              <div>
                <label class="block text-xs text-slate-600 mb-1">Filtrar por texto</label>
                <input id="itemTextSel" type="text" placeholder="ej: hamburguesa, empanada, ipa‚Ä¶" class="rounded-xl border-gray-300"/>
              </div>
              <div>
                <label class="block text-xs text-slate-600 mb-1">Ordenar por</label>
                <select id="itemSortSel" class="rounded-xl border-gray-300">
                  <option value="qty">Unidades</option>
                  <option value="ingreso">Ingresos</option>
                  <option value="veces">Veces</option>
                  <option value="ganancia">Ganancia</option>
                </select>
              </div>
              <div>
                <label class="block text-xs text-slate-600 mb-1">Top N</label>
                <input id="itemTopN" type="number" min="3" value="10" class="w-20 rounded-xl border-gray-300"/>
              </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
              <div class="rounded-xl border p-3">
                <div class="text-sm text-slate-500 mb-2">Top por Unidades (seg√∫n alcance)</div>
                <canvas id="chartTopItems"></canvas>
              </div>
              <div class="overflow-x-auto rounded-xl border">
                <table class="w-full text-sm">
                  <thead class="bg-gray-50 text-slate-600">
                    <tr>
                      <th class="text-left p-2">√çtem</th>
                      <th class="text-right p-2">Unid.</th>
                      <th class="text-right p-2">Veces</th>
                      <th class="text-right p-2">Ingreso</th>
                      <th class="text-right p-2">Ganancia</th>
                      <th class="text-left p-2">Categor√≠a</th>
                    </tr>
                  </thead>
                  <tbody id="tbodyItems" class="divide-y"></tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Horarios -->
          <div class="bg-white rounded-2xl shadow p-4 space-y-2">
            <div class="flex items-center justify-between">
              <h2 class="text-lg font-semibold">Horarios con m√°s ventas</h2>
              <div class="text-xs text-slate-500" id="lblPeakHour"></div>
            </div>
            <div class="rounded-xl border p-3">
              <div class="text-sm text-slate-500 mb-2">Ingresos por hora (seg√∫n alcance)</div>
              <canvas id="chartHoras"></canvas>
            </div>
          </div>

          <!-- Cierre y reparto -->
          <div class="border-t pt-4">
            <h3 class="text-sm font-semibold mb-2">Cierre y reparto</h3>
            <div class="grid grid-cols-2 gap-2">
              <div><label class="block text-xs text-slate-600 mb-1">Personas</label><input id="cierrePersonas" type="number" min="1" value="4" class="w-full rounded-xl border-gray-300" /></div>
              <div><label class="block text-xs text-slate-600 mb-1">Gastos del d√≠a (ARS)</label><input id="cierreGastos" type="number" step="1" value="0" class="w-full rounded-xl border-gray-300" /></div>
            </div>
            <p class="text-xs text-slate-500 mt-2">Usa el d√≠a y horario seleccionados arriba.</p>
          </div>

          <div class="bg-white rounded-2xl shadow p-4">
            <div class="flex items-center justify-between mb-3">
              <h2 class="text-lg font-semibold">Cierre y reparto</h2>
              <span class="text-xs text-slate-500" id="cierreRangoLbl"></span>
            </div>

            <div class="grid grid-cols-2 sm:grid-cols-6 gap-4">
              <div class="rounded-xl border p-3"><div class="text-xs text-slate-500">Ingresos (d√≠a)</div><div id="cierreIng" class="text-xl font-bold money">$0</div></div>
              <div class="rounded-xl border p-3"><div class="text-xs text-slate-500">Costo (d√≠a)</div><div id="cierreCosto" class="text-xl font-bold money">$0</div></div>
              <div class="rounded-xl border p-3"><div class="text-xs text-slate-500">Ganancia bruta</div><div id="cierreBruta" class="text-xl font-bold money">$0</div></div>
              <div class="rounded-xl border p-3"><div class="text-xs text-slate-500">Gastos del local</div><div id="cierreGastosLbl" class="text-xl font-bold money">$0</div></div>
              <div class="rounded-xl border p-3"><div class="text-xs text-slate-500">Ganancia neta</div><div id="cierreNeta" class="text-xl font-bold money">$0</div></div>
              <div class="rounded-xl border p-3"><div class="text-xs text-slate-500">Por persona</div><div id="cierrePorPersona" class="text-xl font-bold money">$0</div></div>
            </div>
          </div>

          <!-- Tabla -->
          <div class="bg-white rounded-2xl shadow p-4">
            <div class="flex items-center justify-between mb-3">
              <h2 class="text-lg font-semibold">Ventas</h2>
              <div class="flex gap-2">
                <button id="btnExcel" class="text-sm px-3 py-1.5 rounded-xl bg-gray-100 hover:bg-gray-200">Descargar Excel</button>
                <button id="btnExcelFact" class="text-sm px-3 py-1.5 rounded-xl bg-gray-100 hover:bg-gray-200">Exportar Facturaci√≥n</button>
                <button id="btnExpandir" class="text-sm px-3 py-1.5 rounded-xl bg-gray-100 hover:bg-gray-200">Expandir items</button>
              </div>
            </div>
            <div class="overflow-x-auto">
              <table class="w-full text-sm">
                <thead class="bg-gray-50 text-slate-600">
                  <tr>
                    <th class="text-left p-2">Fecha</th>
                    <th class="text-left p-2">Cliente</th>
                    <th class="text-left p-2">Mesa</th>
                    <th class="text-left p-2">M√©todo</th>
                    <th class="text-left p-2">Items</th>
                    <th class="text-right p-2">Total</th>
                    <th class="text-right p-2">Ganancia</th>
                  </tr>
                </thead>
                <tbody id="tbodyVentas" class="divide-y"></tbody>
              </table>
            </div>
            <div id="paginador" class="flex flex-wrap items-center gap-2 justify-between mt-3 text-sm"></div>
          </div>
        </main>
      </div>
    </div>
  </main>

  <!-- Panel flotante para elegir qu√© filtros se ven -->
  <div id="panelFiltros" class="hidden fixed inset-0 z-50 flex items-center justify-center">
    <div class="absolute inset-0 bg-black/30"></div>
    <div class="relative bg-white rounded-2xl shadow-xl p-4 w-[min(92vw,420px)]">
      <h4 class="font-semibold mb-3">Mostrar filtros</h4>
      <div class="space-y-2 text-sm">
        <label class="flex items-center gap-2"><input type="checkbox" class="chkFilt" value="filtMes"> Mes</label>
        <label class="flex items-center gap-2"><input type="checkbox" class="chkFilt" value="filtDia"> D√≠a</label>
        <label class="flex items-center gap-2"><input type="checkbox" class="chkFilt" value="filtHorario"> Horario</label>
        <label class="flex items-center gap-2"><input type="checkbox" class="chkFilt" value="filtBuscar"> Buscar</label>
        <label class="flex items-center gap-2"><input type="checkbox" class="chkFilt" value="filtCategoria"> Categor√≠a</label>
      </div>
      <div class="flex justify-end gap-2 mt-4">
        <button id="btnFiltCancelar" class="btn">Cancelar</button>
        <button id="btnFiltGuardar" class="btn">Guardar</button>
      </div>
    </div>
  </div>

  <!-- Tu l√≥gica -->
  <script src="report.js"></script>
</body>
</html>
